<!DOCTYPE html>
<html>
<head>
	<title>Certificate Issuance</title>

	<script src="static/node_modules/web3/dist/web3.min.js"></script>
	<script type="static/web3_functions.js"></script>
</head>
<body>
	<script>
		if (typeof web3 !== 'undefined') {
			web3 = new Web3(web3.currentProvider);
			document.write("Injected Web3");
		} else {
            // set the provider you want from Web3.providers
            web3 = new Web3(new Web3.providers.HttpProvider("http://localhost:8545"));
            document.write("New Web3");
        }

        var contractInstance = web3.eth.contract([
    {
        "constant": false,
        "inputs": [
            {
                "name": "myid",
                "type": "bytes32"
            },
            {
                "name": "result",
                "type": "string"
            }
        ],
        "name": "__callback",
        "outputs": [],
        "payable": false,
        "stateMutability": "nonpayable",
        "type": "function"
    },
    {
        "constant": false,
        "inputs": [
            {
                "name": "myid",
                "type": "bytes32"
            },
            {
                "name": "result",
                "type": "string"
            },
            {
                "name": "proof",
                "type": "bytes"
            }
        ],
        "name": "__callback",
        "outputs": [],
        "payable": false,
        "stateMutability": "nonpayable",
        "type": "function"
    },
    {
        "constant": false,
        "inputs": [
            {
                "name": "year",
                "type": "uint256"
            },
            {
                "name": "root",
                "type": "bytes32"
            }
        ],
        "name": "publish",
        "outputs": [],
        "payable": false,
        "stateMutability": "nonpayable",
        "type": "function"
    },
    {
        "constant": false,
        "inputs": [
            {
                "name": "merklepath",
                "type": "bytes32[]"
            },
            {
                "name": "hash",
                "type": "string"
            },
            {
                "name": "year",
                "type": "uint256"
            }
        ],
        "name": "verify",
        "outputs": [
            {
                "name": "",
                "type": "bytes32"
            }
        ],
        "payable": false,
        "stateMutability": "nonpayable",
        "type": "function"
    },
    {
        "inputs": [],
        "payable": true,
        "stateMutability": "payable",
        "type": "constructor"
    },
    {
        "anonymous": false,
        "inputs": [
            {
                "indexed": false,
                "name": "description",
                "type": "string"
            }
        ],
        "name": "LogNewOraclizeQuery",
        "type": "event"
    },
    {
        "anonymous": false,
        "inputs": [
            {
                "indexed": false,
                "name": "requestID",
                "type": "bytes32"
            },
            {
                "indexed": false,
                "name": "verificationStatus",
                "type": "bool"
            }
        ],
        "name": "VerificationResult",
        "type": "event"
    },
    {
        "anonymous": false,
        "inputs": [
            {
                "indexed": false,
                "name": "requestID",
                "type": "bytes32"
            }
        ],
        "name": "VerificationRequest",
        "type": "event"
    },
    {
        "anonymous": false,
        "inputs": [
            {
                "indexed": false,
                "name": "root",
                "type": "bytes32"
            }
        ],
        "name": "PublishStatus",
        "type": "event"
    },
    {
        "constant": true,
        "inputs": [],
        "name": "calculatedHash",
        "outputs": [
            {
                "name": "",
                "type": "bytes32"
            }
        ],
        "payable": false,
        "stateMutability": "view",
        "type": "function"
    },
    {
        "constant": true,
        "inputs": [
            {
                "name": "",
                "type": "uint256"
            }
        ],
        "name": "certificates",
        "outputs": [
            {
                "name": "",
                "type": "bytes32"
            }
        ],
        "payable": false,
        "stateMutability": "view",
        "type": "function"
    },
    {
        "constant": true,
        "inputs": [],
        "name": "lastid",
        "outputs": [
            {
                "name": "",
                "type": "bytes32"
            }
        ],
        "payable": false,
        "stateMutability": "view",
        "type": "function"
    },
    {
        "constant": true,
        "inputs": [],
        "name": "length",
        "outputs": [
            {
                "name": "",
                "type": "uint256"
            }
        ],
        "payable": false,
        "stateMutability": "view",
        "type": "function"
    },
    {
        "constant": true,
        "inputs": [
            {
                "name": "",
                "type": "bytes32"
            }
        ],
        "name": "requestHash",
        "outputs": [
            {
                "name": "",
                "type": "bytes32"
            }
        ],
        "payable": false,
        "stateMutability": "view",
        "type": "function"
    },
    {
        "constant": true,
        "inputs": [
            {
                "name": "",
                "type": "bytes32"
            },
            {
                "name": "",
                "type": "uint256"
            }
        ],
        "name": "requestPath",
        "outputs": [
            {
                "name": "",
                "type": "bytes32"
            }
        ],
        "payable": false,
        "stateMutability": "view",
        "type": "function"
    },
    {
        "constant": true,
        "inputs": [
            {
                "name": "",
                "type": "bytes32"
            }
        ],
        "name": "requestYear",
        "outputs": [
            {
                "name": "",
                "type": "uint256"
            }
        ],
        "payable": false,
        "stateMutability": "view",
        "type": "function"
    },
    {
        "constant": true,
        "inputs": [],
        "name": "tokenContract",
        "outputs": [
            {
                "name": "",
                "type": "address"
            }
        ],
        "payable": false,
        "stateMutability": "view",
        "type": "function"
    },
    {
        "constant": true,
        "inputs": [],
        "name": "verify1",
        "outputs": [
            {
                "name": "",
                "type": "uint256"
            }
        ],
        "payable": false,
        "stateMutability": "view",
        "type": "function"
    }
]);
        var contract = contractInstance.at('0xc495158b54d274a0e9562b619fdd5b84a22f6910');
        document.write("Contract Created");
        var ar = ["0x0098cac06b454f9c3f5397d73e8bdc9d8a6a9765fc63276c18c9f13744502796", 
        "0xc123098ba4dd9b498a6fcc386d48723f9337abe3ba6eea59b38f4267ffb7790f", 
        "0xcd2f7f567e2b2afd0e209c29789b92b62ffad945e46385058cb39b3074bf0999", 
        "0x6e36c673faf0879fc8ff4ae7c014bdc6f0b5cb037e8308521ad32abfa101276b", 
        "0x324156d49068358c0c452cd1e58610d70ec34ec6a0cfa96a72efa2630c96419e", 
        "0xc964d24ef2a6971f71dcd3a69c4c31bf011e0843d53538b32f644e7ac984aee4", 
        "0xc89ca1574de01eddbbde3fa0731f8546b464ce000e8d8cac63d747454ed9f42a", 
        "0x111c367719409f1dac447418e776d65a70ad147bd4a3b4ca5f8866da6f1c3a9e"]
        function showMessage(){
           contract.publish(201, "0x88533eed01351136c4b1ba7df5e3ec5dc5f78d7c4a2b4f7e21236c7cdbc6158f",function(error, result){
                if(!error){
                    console.log(result);
                }
                else{
                    console.log(error);
                }
            });
        }

        function verify(){
            contract.verify(ar, "0x59298a71f70f3621e114e763846d80b4154d21f41d9591852ecf818fe0b11935",
                201, function(error, result){
                    if(!error){
                        console.log(result);
                    }
                    else{
                        console.log(error);
                    }
                });
        }
        var publishEvent = contract.PublishStatus({}, {fromBlock: 0, toBlock: 'latest'});
        publishEvent.watch(function(error, result){
            if(!error){
                console.log(result);
            }
            else{
                console.log(result);
            }
        });

        var verificationEvent = contract.VerificationResult({}, {fromBlock: 0, toBlock: 'latest'});
        verificationEvent.watch(function(error, result){
            if(!error){
                console.log(result);
            }
        });

        var veriEvent = contract.VerificationRequest({}, {fromBlock: 0, toBlock: 'latest'});
        veriEvent.watch(function(error, result){
            if(!error){
                console.log(result);
            }
        });
    </script>
    <div>
       <input type="button" name="b" value="Hello"  onclick="showMessage();">
       <input type="button" name="b" value="Hello 2"  onclick="verify();">
    </div>
</body>
</html>